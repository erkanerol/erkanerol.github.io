<!doctype html><html class="not-ready text-sm lg:text-base" lang=en-en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<title>How does 'kubectl exec' work? - Blog</title>
<meta name=theme-color>
<meta name=description content="Last Friday, one of my colleagues approached me and asked a question about how to exec a command in a pod with client-go. I didn&rsquo;t know the answer and I noticed that I had never thought about the mechanism in &ldquo;kubectl exec&rdquo;. I had some ideas about how it should be, but I wasn&rsquo;t 100% sure. I noted the topic to check again and I have learnt a lot after reading some blogs, docs and source codes. In this blog post, I am going to share my understanding and findings.

Please ping me if there is something wrong. https://twitter.com/erkan_erol_
">
<meta name=author content="Erkan Erol">
<link rel="preload stylesheet" as=style href=https://erkanerol.github.io/main.min.css>
<script defer src=https://erkanerol.github.io/highlight.min.js onload=hljs.initHighlightingOnLoad()></script>
<link rel=preload as=image href=https://erkanerol.github.io/theme.png>
<link rel=preload as=image href=https://www.gravatar.com/avatar/321108fd00753fd95baeddbc3abc8a76>
<link rel=preload as=image href=https://erkanerol.github.io/twitter.svg>
<link rel=preload as=image href=https://erkanerol.github.io/github.svg>
<link rel=preload as=image href=https://erkanerol.github.io/instagram.svg>
<link rel=preload as=image href=https://erkanerol.github.io/rss.svg>
<link rel=preload as=image href=https://erkanerol.github.io/linkedin.svg>
<link rel=icon href=https://erkanerol.github.io/favicon.ico>
<link rel=apple-touch-icon href=https://erkanerol.github.io/apple-touch-icon.png>
<meta name=generator content="Hugo 0.92.0">
<meta property="og:title" content="How does 'kubectl exec' work?">
<meta property="og:description" content="Last Friday, one of my colleagues approached me and asked a question about how to exec a command in a pod with client-go. I didn&rsquo;t know the answer and I noticed that I had never thought about the mechanism in &ldquo;kubectl exec&rdquo;. I had some ideas about how it should be, but I wasn&rsquo;t 100% sure. I noted the topic to check again and I have learnt a lot after reading some blogs, docs and source codes. In this blog post, I am going to share my understanding and findings.

Please ping me if there is something wrong. https://twitter.com/erkan_erol_
">
<meta property="og:type" content="article">
<meta property="og:url" content="https://erkanerol.github.io/post/how-kubectl-exec-works/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2019-08-25T19:00:00+03:00">
<meta property="article:modified_time" content="2019-08-25T19:00:00+03:00">
<meta itemprop=name content="How does 'kubectl exec' work?">
<meta itemprop=description content="Last Friday, one of my colleagues approached me and asked a question about how to exec a command in a pod with client-go. I didn&rsquo;t know the answer and I noticed that I had never thought about the mechanism in &ldquo;kubectl exec&rdquo;. I had some ideas about how it should be, but I wasn&rsquo;t 100% sure. I noted the topic to check again and I have learnt a lot after reading some blogs, docs and source codes. In this blog post, I am going to share my understanding and findings.

Please ping me if there is something wrong. https://twitter.com/erkan_erol_
"><meta itemprop=datePublished content="2019-08-25T19:00:00+03:00">
<meta itemprop=dateModified content="2019-08-25T19:00:00+03:00">
<meta itemprop=wordCount content="1190">
<meta itemprop=keywords content>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="How does 'kubectl exec' work?">
<meta name=twitter:description content="Last Friday, one of my colleagues approached me and asked a question about how to exec a command in a pod with client-go. I didn&rsquo;t know the answer and I noticed that I had never thought about the mechanism in &ldquo;kubectl exec&rdquo;. I had some ideas about how it should be, but I wasn&rsquo;t 100% sure. I noted the topic to check again and I have learnt a lot after reading some blogs, docs and source codes. In this blog post, I am going to share my understanding and findings.

Please ping me if there is something wrong. https://twitter.com/erkan_erol_
">
<script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'),ga('create','UA-57796113-2','auto'),ga('send','pageview')</script>
</head>
<body class="text-black duration-200 ease-out dark:text-white">
<header class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center">
<div class="relative z-50 mr-auto flex items-center">
<a class="-translate-x-[1px] -translate-y-0.5 text-3xl font-bold" href=https://erkanerol.github.io/>Blog</a>
<a class="btn-dark ml-6 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"></a>
</div>
<a class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"></a>
<script>const metaTheme=document.querySelector('meta[name="theme-color"]'),htmlClass=document.documentElement.classList;setTimeout(()=>htmlClass.remove('not-ready'),10);const setDark=a=>{metaTheme.setAttribute('content',a?'#000':'#fbfbfb'),htmlClass[a?'add':'remove']('dark'),localStorage.setItem('dark',a)},darkScheme=window.matchMedia('(prefers-color-scheme: dark)'),darkVal=localStorage.getItem('dark');setDark(darkVal?darkVal==='true':darkScheme.matches),darkScheme.addEventListener('change',a=>{setDark(a.matches)});const btnDark=document.querySelector('.btn-dark');btnDark.addEventListener('click',()=>{setDark(localStorage.getItem('dark')!=='true')});const btnMenu=document.querySelector('.btn-menu');btnMenu.addEventListener('click',()=>{htmlClass.toggle('open')})</script>
<div class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none">
<nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/categories/tr/>Turkish</a>
<a class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal" href=/categories/en/>English</a>
</nav>
<nav class="mt-12 flex justify-center space-x-10 dark:invert lg:mt-0 lg:ml-12 lg:items-center lg:space-x-6">
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./twitter.svg) href=https://twitter.com/erkan_erol_ target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./github.svg) href=https://github.com/erkanerol target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./instagram.svg) href=https://instagram.com/theerkanerol target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./rss.svg) href=https://erkanerol.github.io/index.xml target=_blank></a>
<a class="h-8 w-8 [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6" style=--url:url(./linkedin.svg) href=https://linkedin.com//in/erkanerol target=_blank></a>
</nav>
</div>
</header>
<main class="prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 pb-32 dark:prose-invert">
<article>
<header class=mb-20>
<h1 class="!my-0 pb-2.5">How does 'kubectl exec' work?</h1>
<div class="text-sm opacity-60">
<time>Aug 25, 2019</time>
<span class=mx-1>&#183;</span>
<span>Erkan Erol</span>
</div>
</header>
<section><p>Last Friday, one of my colleagues approached me and asked a question about how to exec a command in a pod with client-go. I didn&rsquo;t know the answer and I noticed that I had never thought about the mechanism in &ldquo;kubectl exec&rdquo;. I had some ideas about how it should be, but I wasn&rsquo;t 100% sure. I noted the topic to check again and I have learnt a lot after reading some blogs, docs and source codes. In this blog post, I am going to share my understanding and findings.</p>
<blockquote>
<p>Please ping me if there is something wrong. <a href=https://twitter.com/erkan_erol>https://twitter.com/erkan_erol</a>_</p>
</blockquote>
<p><br><br></p>
<h2 id=setup>Setup</h2>
<p>I cloned <a href=https://github.com/ecomm-integration-ballerina/kubernetes-cluster>https://github.com/ecomm-integration-ballerina/kubernetes-cluster</a> in order to create a k8s cluster in my MacBook. I fixed IP addresses of the nodes in kubelet configurations since the default configuration didn&rsquo;t let me run <code>kubectl exec</code>. You can find the root cause <a href=https://medium.com/@joatmon08/playing-with-kubeadm-in-vagrant-machines-part-2-bac431095706>here</a>.</p>
<ul>
<li>Any machine = my MacBook</li>
<li>IP of master node = 192.168.205.10</li>
<li>IP of worker node = 192.168.205.11</li>
<li>API server port = 6443</li>
</ul>
<p><br><br></p>
<h2 id=components>Components</h2>
<p><img src=/img/kubectl-exec/components.png alt=Components></p>
<ul>
<li>
<p><em><strong>kubectl exec process:</strong></em> When we run &ldquo;kubectl exec &mldr;&rdquo; in a machine, a process starts. You can run it in any machine which has an access to k8s api server.</p>
</li>
<li>
<p><em><strong><a href=https://kubernetes.io/docs/concepts/overview/components/#kube-apiserver>api server</a>:</strong></em> Component on the master that exposes the Kubernetes API. It is the front-end for the Kubernetes control plane.</p>
</li>
<li>
<p><em><strong><a href=https://kubernetes.io/docs/concepts/overview/components/#kubelet>kubelet</a>:</strong></em> An agent that runs on each node in the cluster. It makes sure that containers are running in a pod.</p>
</li>
<li>
<p><em><strong><a href=https://kubernetes.io/docs/concepts/overview/components/#container-runtime>container runtime</a>:</strong></em> The software that is responsible for running containers. Examples: docker, cri-o, containerd&mldr;</p>
</li>
<li>
<p><em><strong>kernel:</strong></em> kernel of the OS in the worker node which is responsible to manage processes.</p>
</li>
<li>
<p><em><strong>target container:</strong></em> A container which is a part of a pod and which is running on one of the worker nodes.</p>
</li>
</ul>
<p><br><br></p>
<h2 id=findings>Findings</h2>
<h3 id=1-activities-in-client-side>1. Activities in Client Side</h3>
<ul>
<li>Create a pod in default namespace</li>
</ul>
<pre tabindex=0><code>// any machine
$ kubectl run exec-test-nginx --image=nginx
</code></pre><ul>
<li>Then run an exec command and <code>sleep 5000</code> to make observation</li>
</ul>
<pre tabindex=0><code>// any machine
$ kubectl exec -it exec-test-nginx-6558988d5-fgxgg -- sh
# sleep 5000
</code></pre><ul>
<li>We can observe the kubectl process (pid=8507 in this case)</li>
</ul>
<pre tabindex=0><code>// any machine
$ ps -ef |grep kubectl
501  8507  8409   0  7:19PM ttys000    0:00.13 kubectl exec -it exec-test-nginx-6558988d5-fgxgg -- sh
</code></pre><ul>
<li>When we check network activities of the process, we can see that it has some connections to api-server (192.168.205.10.6443)</li>
</ul>
<pre tabindex=0><code>// any machine
$ netstat -atnv |grep 8507
tcp4       0      0  192.168.205.1.51673    192.168.205.10.6443    ESTABLISHED 131072 131768   8507      0 0x0102 0x00000020
tcp4       0      0  192.168.205.1.51672    192.168.205.10.6443    ESTABLISHED 131072 131768   8507      0 0x0102 0x00000028
</code></pre><ul>
<li>Let&rsquo;s check the code. kubectl creates a POST request with subresource <code>exec</code> and sends a rest request.
<script src="https://gist-it.appspot.com/http://github.com/kubernetes/kubernetes/blob/a1f1f0b599e961a5c59b02c349c0ed818b1851a5/staging/src/k8s.io/kubectl/pkg/cmd/exec/exec.go?slice=344:359"></script>
</li>
</ul>
<p><img src=/img/kubectl-exec/rest-request.png alt=rest-request></p>
<br>
<h3 id=2-activities-in-master-node>2. Activities in Master Node</h3>
<ul>
<li>We can observe the request in api-server side as well.</li>
</ul>
<pre tabindex=0><code>handler.go:143] kube-apiserver: POST &quot;/api/v1/namespaces/default/pods/exec-test-nginx-6558988d5-fgxgg/exec&quot; satisfied by gorestful with webservice /api/v1
upgradeaware.go:261] Connecting to backend proxy (intercepting redirects) https://192.168.205.11:10250/exec/default/exec-test-nginx-6558988d5-fgxgg/exec-test-nginx?command=sh&amp;input=1&amp;output=1&amp;tty=1
Headers: map[Connection:[Upgrade] Content-Length:[0] Upgrade:[SPDY/3.1] User-Agent:[kubectl/v1.12.10 (darwin/amd64) kubernetes/e3c1340] X-Forwarded-For:[192.168.205.1] X-Stream-Protocol-Version:[v4.channel.k8s.io v3.channel.k8s.io v2.channel.k8s.io channel.k8s.io]]
</code></pre><pre><code>&gt; Notice that the http request includes a protocol upgrade request. [SPDY](https://www.wikiwand.com/en/SPDY) allows for separate stdin/stdout/stderr/spdy-error &quot;streams&quot; to be multiplexed over a single TCP connection.
</code></pre>
<ul>
<li>Api server receives the request and binds it into a <code>PodExecOptions</code></li>
</ul>
<script src="https://gist-it.appspot.com/http://github.com/kubernetes/kubernetes/blob/a1f1f0b599e961a5c59b02c349c0ed818b1851a5/pkg/apis/core/types.go?slice=4124:4147"></script>
<ul>
<li>
<p>To be able to take necessary actions, api-server needs to know which location it should contact.</p>
<script src="https://gist-it.appspot.com/http://github.com/kubernetes/kubernetes/blob/a1f1f0b599e961a5c59b02c349c0ed818b1851a5/pkg/registry/core/pod/strategy.go?slice=455:467"></script><br>
<p>Of course the endpoint is derived from node info.</p>
<script src="https://gist-it.appspot.com/http://github.com/kubernetes/kubernetes/blob/a1f1f0b599e961a5c59b02c349c0ed818b1851a5/pkg/registry/core/pod/strategy.go?slice=504:510"></script><br>
<p>GOTCHA! KUBELET HAS A PORT (<code>node.Status.DaemonEndpoints.KubeletEndpoint.Port</code>) TO WHICH API-SERVER CAN CONNECT.</p>
<script src="https://gist-it.appspot.com/http://github.com/kubernetes/kubernetes/blob/a1f1f0b599e961a5c59b02c349c0ed818b1851a5/pkg/kubelet/client/kubelet_client.go?slice=180:206"></script><br>
<blockquote>
<p><a href=https://kubernetes.io/docs/concepts/architecture/master-node-communication/#apiserver-to-kubelet>Master-Node Communication > Master to Cluster > apiserver to kubelet</a></p>
</blockquote>
<blockquote>
<p>These connections terminate at the kubelet’s HTTPS endpoint. By default, the apiserver does not verify the kubelet’s serving certificate, which makes the connection subject to man-in-the-middle attacks, and <em><strong>unsafe</strong></em> to run over untrusted and/or public networks.</p>
</blockquote>
</li>
<li>
<p>Now, api server knows the endpoint and it opens a connections.</p>
<script src="https://gist-it.appspot.com/http://github.com/kubernetes/kubernetes/blob/a1f1f0b599e961a5c59b02c349c0ed818b1851a5/pkg/registry/core/pod/rest/subresources.go?slice=132:144"></script><br>
</li>
<li>
<p>Let&rsquo;s check what is going on the master node.</p>
</li>
</ul>
<p>First, learn the ip of the worker node. It is <code>192.168.205.11</code> in this case.</p>
<pre tabindex=0><code>// any machine
$ kubectl get nodes k8s-node-1 -o wide
NAME         STATUS   ROLES    AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE             KERNEL-VERSION      CONTAINER-RUNTIME
k8s-node-1   Ready    &lt;none&gt;   9h    v1.15.3   192.168.205.11   &lt;none&gt;        Ubuntu 16.04.6 LTS   4.4.0-159-generic   docker://17.3.3
</code></pre><p>Then get the kubelet port. It is <code>10250</code> in this case.</p>
<pre tabindex=0><code>// any machine
$ kubectl get nodes k8s-node-1 -o jsonpath='{.status.daemonEndpoints.kubeletEndpoint}'
map[Port:10250]
</code></pre><p>Then check the network. Is there a connection to worker node(192.168.205.11)? THE CONNECTİON IS THERE. When I kill the exec process, it disappears so I know it is set by api-server because of my exec command.</p>
<pre tabindex=0><code>// master node
$ netstat -atn |grep 192.168.205.11
tcp        0      0 192.168.205.10:37870    192.168.205.11:10250    ESTABLISHED
...
</code></pre><p><img src=/img/kubectl-exec/api-server-to-kubelet.png alt=api-server-to-kubelet></p>
<ul>
<li>Now the connection between kubectl and api-server is still open and there is another connection between api-server and kubelet.</li>
</ul>
<p><br><br></p>
<h3 id=3-activities-in-worker-node>3. Activities in Worker Node</h3>
<ul>
<li>
<p>Let&rsquo;s continue by connecting to the worker node and checking what is going on the worker node.</p>
<p>First, we can observe the connection here as well. The second line. <code>192.168.205.10</code> is the IP of master node.</p>
<pre tabindex=0><code>// worker node
$ netstat -atn |grep 10250
tcp6       0      0 :::10250                :::*                    LISTEN
tcp6       0      0 192.168.205.11:10250    192.168.205.10:37870    ESTABLISHED
</code></pre><p>What about our sleep command? HOORAYYYY!! OUR COMMAND IS THERE!!!!</p>
<pre tabindex=0><code>// worker node
$ ps -afx
...
31463 ?        Sl     0:00      \_ docker-containerd-shim 7d974065bbb3107074ce31c51f5ef40aea8dcd535ae11a7b8f2dd180b8ed583a /var/run/docker/libcontainerd/7d974065bbb3107074ce31c51
31478 pts/0    Ss     0:00          \_ sh
31485 pts/0    S+     0:00              \_ sleep 5000
...
</code></pre></li>
<li>
<p>Wait! How did kubelet do it?</p>
</li>
<li>
<p>kubelet has a daemon which serves an api over a port for api-server requests.</p>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/33081c1f07be128a89441a39c467b7ea2221b23d/pkg/kubelet/server/streaming/server.go?slice=41:60"></script><br>
</li>
<li>
<p>kubelet computes a response endpoint for exec requests.</p>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/33081c1f07be128a89441a39c467b7ea2221b23d/pkg/kubelet/server/streaming/server.go?slice=177:190"></script><br>
<p>Don&rsquo;t confuse. It doesn&rsquo;t return the result of the command. It returns an endpoint for communication.</p>
</li>
</ul>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/6568325ca2bef519e5c8228cd33887660b5ed7b0/staging/src/k8s.io/cri-api/pkg/apis/runtime/v1alpha2/api.pb.go?slice=4533:4540"></script><br>
<p>kubelet implements <code>RuntimeServiceClient</code> interface which is part of Container Runtime Interface.</p>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/6568325ca2bef519e5c8228cd33887660b5ed7b0/staging/src/k8s.io/cri-api/pkg/apis/runtime/v1alpha2/api.pb.go?slice=7157:7229"></script><br>
<p>It just uses gRPC to invoke a method through Container Runtime Interface.</p>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/6568325ca2bef519e5c8228cd33887660b5ed7b0/staging/src/k8s.io/cri-api/pkg/apis/runtime/v1alpha2/api.pb.go?slice=7229:7233"></script><br>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/6568325ca2bef519e5c8228cd33887660b5ed7b0/staging/src/k8s.io/cri-api/pkg/apis/runtime/v1alpha2/api.pb.go?slice=7372:7381"></script><br>
<p>Container Runtime is responsible to implement <code>RuntimeServiceServer</code></p>
<script src="https://gist-it.appspot.com/https://github.com/kubernetes/kubernetes/blob/6568325ca2bef519e5c8228cd33887660b5ed7b0/staging/src/k8s.io/cri-api/pkg/apis/runtime/v1alpha2/api.pb.go?slice=7436:7508"></script><br>
<p><img src=/img/kubectl-exec/kubelet-to-container-runtime.png alt=kubelet-to-container-runtime></p>
<ul>
<li>If it is so, we need to observe a connection between kubelet and container runtime. Right? Let&rsquo;s check.</li>
</ul>
<p>Run this command before and after running exec command and check the diff. This one is the diff in my case.</p>
<pre tabindex=0><code>// worker node
$ ss -a -p |grep kubelet
...
u_str  ESTAB      0      0       * 157937                * 157387                users:((&quot;kubelet&quot;,pid=5714,fd=33))
...
</code></pre><p>Hımmm. There is a new connection via unix sockets between kubelet(pid=5714) and something. Who can be? YES. IT IS DOCKER(pid=1186).</p>
<pre tabindex=0><code>// worker node
$ ss -a -p |grep 157387
...
u_str  ESTAB      0      0       * 157937                * 157387                users:((&quot;kubelet&quot;,pid=5714,fd=33))
u_str  ESTAB      0      0      /var/run/docker.sock 157387                * 157937                users:((&quot;dockerd&quot;,pid=1186,fd=14))
...
</code></pre><p>Remember. This is the docker daemon process(pid=1186) which runs our command.</p>
<pre tabindex=0><code>// worker node.
$ ps -afx
...
 1186 ?        Ssl    0:55 /usr/bin/dockerd -H fd://
17784 ?        Sl     0:00      \_ docker-containerd-shim 53a0a08547b2f95986402d7f3b3e78702516244df049ba6c5aa012e81264aa3c /var/run/docker/libcontainerd/53a0a08547b2f95986402d7f3
17801 pts/2    Ss     0:00          \_ sh
17827 pts/2    S+     0:00              \_ sleep 5000
...
</code></pre><h3 id=4-activities-in-container-runtime>4. Activities in Container Runtime</h3>
<ul>
<li>
<p>Let&rsquo;s check cri-o&rsquo;s source code to understand how it can happen. The logic is similar in docker.</p>
<p>It has a server which implements RuntimeServiceServer.</p>
<script src="https://gist-it.appspot.com/https://github.com/cri-o/cri-o/blob/b3c67952115bee6f44405f547fef0b65a9134c60/server/server.go?slice=60:82"></script><br>
<script src="https://gist-it.appspot.com/https://github.com/cri-o/cri-o/blob/b3c67952115bee6f44405f547fef0b65a9134c60/server/container_exec.go?slice=13:28"></script><br>
<p>At the end of the chain, container runtime executes the command in the worker node.</p>
<script src="https://gist-it.appspot.com/https://github.com/cri-o/cri-o/blob/b3c67952115bee6f44405f547fef0b65a9134c60/internal/oci/runtime_oci.go?slice=292:342"></script><br>
</li>
</ul>
<p><img src=/img/kubectl-exec/container-runtime-to-kernel.png alt=container-runtime-to-kernel></p>
<p>Finally, kernel executes commands.
![/img/kubectl-exec/kernel-puts.png" title=&ldquo;kernel-puts](/img/kubectl-exec/kernel-puts.png&rdquo; title=&ldquo;kernel-puts)</p>
<p><br><br></p>
<h2 id=reminders>Reminders</h2>
<ul>
<li>api-server can also initialize a connection to kubelet.</li>
<li>These connections persist until the interactive exec ends.
<ul>
<li>Connection between kubectl and api-server</li>
<li>Connection between api-server and kubelet</li>
<li>Connection between kubelet and container runtime</li>
</ul>
</li>
<li>kubectl or api-server cannot run anything in the worker nodes. kubelet can run but it also interacts with container runtime for this kind of actions.</li>
</ul>
<p><br><br></p>
<h2 id=resources>Resources</h2>
<ul>
<li><a href=https://groups.google.com/forum/#!topic/kubernetes-dev/Cjia36v39vM>https://groups.google.com/forum/#!topic/kubernetes-dev/Cjia36v39vM</a></li>
<li><a href=https://medium.com/@joatmon08/playing-with-kubeadm-in-vagrant-machines-part-2-bac431095706>https://medium.com/@joatmon08/playing-with-kubeadm-in-vagrant-machines-part-2-bac431095706</a></li>
<li><a href=https://serverfault.com/questions/252723/how-to-find-other-end-of-unix-socket-connection>https://serverfault.com/questions/252723/how-to-find-other-end-of-unix-socket-connection</a></li>
</ul></section>
<nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
<a class="flex w-1/2 items-center p-6 pr-3 no-underline" href=https://erkanerol.github.io/post/who-sets-ip-of-a-pod/><span class=mr-1.5>←</span><span>Who sets the IP of a pod?</span></a>
<a class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline" href=https://erkanerol.github.io/post/yazgilari-birlestirme-enstitusu/><span>Yazgıları Birleştirme Enstitüsü</span><span class=ml-1.5>→</span></a>
</nav>
</article>
</main>
<footer class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60">
<div class=mr-auto>
&copy; 2022
<a class=link href=https://erkanerol.github.io/>Blog</a>
</div>
<a class="link mx-6" href=https://gohugo.io/ rel=noopener target=_blank>Powered by Hugo️️</a>️
<a class=link href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>▷ Paper 6</a>
</footer>
</body>
</html>